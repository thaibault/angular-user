'use strict';
(function(l,m){'object'==typeof exports&&'object'==typeof module?module.exports=m(require('@angular/core'),require('@angular/flex-layout'),require('@angular/forms'),require('@angular/material'),require('@angular/platform-browser'),require('@angular/router'),require('angular-generic'),require('pouchdb-authentication/dist/pouchdb.authentication.min.js'),require('rxjs/Observable'),require('rxjs/add/observable/fromPromise')):'function'==typeof define&&define.amd?define('angular-user',['@angular/core','@angular/flex-layout','@angular/forms','@angular/material','@angular/platform-browser','@angular/router','angular-generic','pouchdb-authentication/dist/pouchdb.authentication.min.js','rxjs/Observable','rxjs/add/observable/fromPromise'],m):'object'==typeof exports?exports['angular-user']=m(require('@angular/core'),require('@angular/flex-layout'),require('@angular/forms'),require('@angular/material'),require('@angular/platform-browser'),require('@angular/router'),require('angular-generic'),require('pouchdb-authentication/dist/pouchdb.authentication.min.js'),require('rxjs/Observable'),require('rxjs/add/observable/fromPromise')):l['angular-user']=m(l['@angular/core'],l['@angular/flex-layout'],l['@angular/forms'],l['@angular/material'],l['@angular/platform-browser'],l['@angular/router'],l['angular-generic'],l['pouchdb-authentication/dist/pouchdb.authentication.min.js'],l['rxjs/Observable'],l['rxjs/add/observable/fromPromise'])})(this,function(k,l,m,n,o,p,q,r,s,t){return function(u){function v(x){if(w[x])return w[x].exports;var y=w[x]={i:x,l:!1,exports:{}};return u[x].call(y.exports,y,y.exports,v),y.l=!0,y.exports}var w={};return v.m=u,v.c=w,v.i=function(x){return x},v.d=function(x,y,z){v.o(x,y)||Object.defineProperty(x,y,{configurable:!1,enumerable:!0,get:z})},v.n=function(x){var y=x&&x.__esModule?function(){return x['default']}:function(){return x};return v.d(y,'a',y),y},v.o=function(x,y){return Object.prototype.hasOwnProperty.call(x,y)},v.p='',v(v.s=12)}([function(u,v,w){'use strict';(function(x){function y(V){return V&&V.__esModule?V:{default:V}}function z(V){return function(){var W=V.apply(this,arguments);return new Promise(function(X,Y){function Z($,_){try{var aa=W[$](_),ba=aa.value}catch(ca){return void Y(ca)}return aa.done?void X(ba):Promise.resolve(ba).then(function(ca){Z('next',ca)},function(ca){Z('throw',ca)})}return Z('next')})}}var A,B,C,D,E,F,G=w(8),H=y(G),I=w(2),J=w(3),K=w(4),L=w(5),M=w(6),N=w(7),O=w(9),P=y(O),Q=w(10);v.__esModule=!0,v.default=v.LoginComponent=v.AuthenticationGuard=void 0,w(11);try{x.require('source-map-support/register')}catch(V){}var R=v.a=(A=(0,I.Injectable)(),A(B=class{constructor(V,W){this.data=this.data,this.error=null,this.observingDatabaseChanges=!1,this.router=this.router,this.lastRequestedURL=null,this.data=V,this.data.database=this.data.database.plugin(P.default),this.router=W}canActivate(V,W){return Q.Observable.fromPromise(this.checkLogin(W.url))}canActivateChild(V,W){return this.canActivate(V,W)}checkLogin(V=null){var W=this;return z(function*(){var X;try{X=yield W.data.connection.getSession()}catch(Y){return W.error=Y,V&&(W.lastRequestedURL=V),W.router.navigate(['/login']),!1}return(W.error=null,X.userCtx.name)?(W.observingDatabaseChanges||W.data.register(['get','put','post','remove'],function(){var Y=z(function*(Z){try{Z=yield Z}catch($){if($.hasOwnProperty('name')&&'unauthorized'===$.name)W.router.navigate(['/login']);else throw $}return Z});return function(){return Y.apply(this,arguments)}}()),!0):(V&&(W.lastRequestedURL=V),W.router.navigate(['/login']),!1)})()}})||B);Reflect.defineMetadata('design:paramtypes',[G.GenericDataService,N.Router],R);var R=v.a=(C=(0,I.Component)({selector:'login',template:`
        <div fxLayout="column" fxLayoutAlign="center center">
            <div *ngIf="errorMessage">{{errorMessage}}</div>
            <md-input placeholder="login" [(ngModel)]="login"></md-input>
            <md-input
                type="password" placeholder="password" [(ngModel)]="password">
            </md-input>
            <button md-raised-button (click)="performLogin()">login</button>
        </div>
    `}),C(D=class{constructor(V,W,X,Y){var Z=this;this._authentication=this._authentication,this._data=this._data,this._representObject=this._representObject,this._router=this._router,this.errorMessage='',this.login=this.login,this.password=this.password,this._authentication=V,this._authentication.checkLogin().then(function($){$&&Z._router.navigate(['/'])}),this._data=W,this._representObject=Y.transform.bind(Y),this._router=X}performLogin(){var V=this;return z(function*(){V.errorMessage='';try{yield V._data.connection.login(V.login,V.password)}catch(W){return void(V.errorMessage=W.hasOwnProperty('message')?W.message:V._representObject(W))}V.errorMessage='',V._router.navigateByUrl(V._authentication.lastRequestedURL||'/')})()}})||D);Reflect.defineMetadata('design:paramtypes',[AuthenticationGuard,G.GenericDataService,N.Router,G.GenericRepresentObjectPipe],R);var S=Object.keys(x.exports).filter(function(V){return!V.startsWith('Abstract')&&(V.endsWith('Component')||V.endsWith('Pipe'))}).map(function(V){return x.exports[V]}),T=Object.keys(x.exports).filter(function(V){return!V.startsWith('Abstract')&&(V.endsWith('Resolver')||V.endsWith('Pipe')||V.endsWith('Guard')||V.endsWith('Service'))}).map(function(V){return x.exports[V]}),U=[M.BrowserModule,J.FlexLayoutModule.forRoot(),K.FormsModule,H.default,L.MaterialModule.forRoot()],R=(E=(0,I.NgModule)({declarations:S,exports:S,imports:U,providers:T}),E(F=class{})||F);v.default=R}).call(v,w(1)(u))},function(u){u.exports=function(w){return w.webpackPolyfill||(w.deprecate=function(){},w.paths=[],!w.children&&(w.children=[]),Object.defineProperty(w,'loaded',{enumerable:!0,get:function(){return w.l}}),Object.defineProperty(w,'id',{enumerable:!0,get:function(){return w.i}}),w.webpackPolyfill=1),w}},function(u){u.exports=k},function(u){u.exports=l},function(u){u.exports=m},function(u){u.exports=n},function(u){u.exports=o},function(u){u.exports=p},function(u){u.exports=q},function(u){u.exports=r},function(u){u.exports=s},function(u){u.exports=t},function(u,v,w){u.exports=w(0)}])});